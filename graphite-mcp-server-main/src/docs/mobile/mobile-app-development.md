# Mobile App Development Information

This document provides definitions of Maximo Mobile application flags and their usage. App developers can take advantage of this information during app development.

## Key Concepts and Attributes

### anywhererefid

Used to uniquely identify a Maximo Mobile transaction that adds child records, for example, work logs or labor transactions. This attribute is used to avoid duplicating records. An anywhererefid value is generated during Maximo Mobile data transactions.

An anywhererefid value is included with a database object that is exposed through object structures.

For more information about adding a new column to an existing Maximo database table, refer to [Adding attributes to an object in an extension table](https://www.ibm.com/docs/de/mam/7.6.0?topic=data-adding-attributes-object-in-extension-table).

![Anywhererefid at maximo database object](../images/dbo-anywhererefid.png)

Example: The database object WORKORDER is exposed through the object structure MXAPIWODETAILS. In this example, the anywhererefid would be associated with the WORKORDER database object.

After the anywhererefid value is defined for a Maximo database object, it must be declared at the graphite datasource through a datasource attribute.

![Anywhererefid at maximo mobile application](../images/ds-anywhererefid-example.png)

### addNew

The addNew method does not create a record on the Maximo server. This method adds a new record to the JSON datasource. The new record is discarded unless the datasource is saved. When the datasource is saved, a call is made to the OSLC API to add a new record on the Maximo server.
The API call uses the rsmeta=1 and action=new parameters with no body.

```
@param {object} opts - Object contain the objectStructure and responseProperties.
@returns {object} New empty record.
```

Maximo Mobile does not instruct the Maximo server to create a new record. Required and autogenerated fields are not assigned values by default. When you build a Maximo Mobile application, ensure that all required fields have values before you save the new record.

For records created by Maximo Mobile a TEMP_HREF value is created to uniquely identify the new record locally. After the record is saved and sent to Maximo Server, it is updated by an HREF value generated by the Maximo server.

> **Note**: If you plan to add new data from a mobile device, review the information on how to use anywhererefid. Familiarizing yourself with that information helps avoid lost records and duplication of child data.

### TEMP_HREF

New Maximo Mobile records have TEMP_HREF values that identify them as Maximo Mobile records that were not created on the Maximo server. The TEMP_HREF value is replaced with a record HREF value when the record is created on the Maximo server and validated.

The TEMP_HREF value is used on parent records such as Work Order records. Children of the parent record do not use the TEMP_HREF value.

The HREF attribute of a record is set when the addNew method is called. When you add new data to the top level record, use the addNew method to enter child data, if required. Then save the datasource after the data is entered.

> **Note**: To avoid child data duplication, see the anywhererefid documentation.

## Data Loading and Synchronization

### How load and forceSync works in Maximo Mobile

If a datasource is not downloaded immediately, or if it is not designated as lookup data, it is downloaded and stored offline. It can be viewed in context of the view it was created for. After its initial load, the data is retrieved from the local storage instead of contacting the Maximo server.

You can use the forceSync method of a datasource to ensure that the latest data is retrieved and displayed if a connection to the Maximo server is active. If the Maximo server cannot be reached, data is retrieved from the offline storage.

#### Using forceSync at the entry datasource

![Calling force load from datasource](../images/ds_full_force_reload.png)

#### forceSync on a specific row

![Calling force load at single row](../images/forceSync_single_record.png)

> **Note**: Maximo Mobile applications should not constantly connect to the Maximo server to fetch data due to connection instability in the field. Use the forceSync method to initiate a connection with the Maximo server to refresh data.

### Add attachment

Since Maximo Mobile runs on mobile devices, it has limited resources (memory, processor, etc.) available compared to web clients that usually run on personal computers.

Given this client limitation, some caution needs to be taken when adding a new attachment to avoid issues like the application running out of memory.

To add a new attachment, the attachment datasource instance needs to be retrieved and the addAttachment method should be used.

![Example of attachments at first level of relationship](../images/attachmentDSDirectRelation.png)

![Example of attachments at second level of relationship](../images/attachmentDsSecondLevelRelarionShip.png)

### Goto and edit record

When an error happens with a record, it will be displayed in the navigator error screen. It can be discarded (and all new data will be lost) or it can be edited and resent to the Maximo server.

When a user opens this screen and clicks on the arrow icon to edit a record with an error, some configuration may be required in the loadApp method of the ErrorController class of the Maximo Mobile navigator.

This method receives the current errored transaction as an argument and handles the logic to navigate to the appropriate application for editing the record.

![goTo button at navigator app.xml](../images/gotoButton.png)

In the loadApp method, the logic to navigate to the application is managed:

1. This method receives the item to be edited
2. Builds the context and options required to call the gotoApplication method from AppSwitcher
3. Builds the breadcrumb to help with navigation
4. Sets the transaction to edit mode using the method setEditErrorMode of txManager
5. Calls the switcher to redirect

> **Note**: For more information on the gotoApplication method from AppSwitcher, please refer to the Graphite documentation.

## Local Data Management

### localPayload

Local payload is an internal attribute of Maximo Mobile transactions. The purpose of this attribute is to store and manage data in Maximo Mobile before it reaches Maximo.

The localPayload allows Maximo Mobile to manage and display the correct data to mobile clients. While a record has a pending transaction, the data displayed to the user is the data available in the localPayload. As soon as the transaction is sent to Maximo, the server response is merged with the data in the offline database and the localPayload is deleted.

#### Local payload for application developers

Since Maximo Mobile does not send a request to Maximo when adding a new record or saving a record, and considering that offline applications may need some calculations to display to users, localPayload can be added to the transaction.

In the localPayload, developers should calculate and include the data they want to display to the user. If a new data transaction has a localPayload, it will be merged with the data defined by the user and returned to the UI.

### Saving data in Maximo Mobile

Saving in Maximo Mobile acts differently than in the web version of the application. When a record is added/edited in Maximo Mobile, the data is not directly sent to the Maximo server. Instead, it creates an offline transaction that will be sent to the server when the platform determines it is the appropriate time (when connection with Maximo server is available).

For this reason, the record does not get business rules applied right after its creation, since the Maximo workflow will be applied to the data when it reaches the Maximo server. Since the data is not validated right after its creation/addition, an error may occur when it is sent to Maximo. In case of error, the record with error will be displayed in the Maximo Mobile navigator in the transaction section.

> **Note**: As best practice, applications running on Maximo Mobile should validate data as much as possible to avoid errors when data is sent to Maximo. Adding new records also has some extra considerations; please refer to the Add new record documentation.

## Push Notification Configuration

Online documentation is provided to [setup push notifications for MAS](https://www.ibm.com/docs/en/mas-cd/maximo-manage/continuous-delivery?topic=mobile-push-notifications).

### Configuration Steps

1. JMS queue configuration on MAS is automated.
2. Next, the API key needs to be created and configured. Follow the steps outlined [here](https://www.ibm.com/docs/en/mas-cd/maximo-manage/continuous-delivery?topic=notifications-creating-configuring-api-keys-push).

> **Note**: Ensure you save the API key somewhere after copying it as it will not be retrievable later.

3. Configure MAS notifications by following [these instructions](https://www.ibm.com/docs/en/mas-cd/maximo-manage/continuous-delivery?topic=notifications-configuring-maximo-application-suite).

> **Note**: Ensure the following System Properties are set with the Manage URL, not localhost: mxe.oslc.webappurl, mxe.oslc.restwebappurl, mxe.int.webappurl, mxe.pluss.webappurl

### Troubleshooting Push Notifications

If Notifications are not received on the device after a WO with correct criteria is updated in Manage, check the "Message Reprocessing" application in Manage for any Messages that have errors. The push notification queue is sequential, so any stuck transactions will need to be processed (Select Action > Process Selected Messages) or deleted (Select Action > Delete Selected Messages). DO NOT Delete All Messages.

Logs are located in the OpenShift console under Workloads > Pods, search for push-notification-service.